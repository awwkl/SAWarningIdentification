GitDiffStart: cb1a9a0cdf503d181254b0c2287460a7e8693809 | Sun Mar 25 21:37:55 2012 +0000
diff --git a/lucene/core/src/java/org/apache/lucene/util/RollingCharBuffer.java b/lucene/core/src/java/org/apache/lucene/util/RollingCharBuffer.java
index bd840f4..5320c30 100644
--- a/lucene/core/src/java/org/apache/lucene/util/RollingCharBuffer.java
+++ b/lucene/core/src/java/org/apache/lucene/util/RollingCharBuffer.java
@@ -92,7 +92,7 @@ public final class RollingCharBuffer {
       assert pos < nextPos;
 
       // Cannot read from already freed past:
-      assert nextPos - pos <= count;
+      assert nextPos - pos <= count: "nextPos=" + nextPos + " pos=" + pos + " count=" + count;
 
       final int index = getIndex(pos);
       return buffer[index];
diff --git a/modules/analysis/kuromoji/src/java/org/apache/lucene/analysis/kuromoji/KuromojiTokenizer.java b/modules/analysis/kuromoji/src/java/org/apache/lucene/analysis/kuromoji/KuromojiTokenizer.java
index 0277228..85fe911 100644
--- a/modules/analysis/kuromoji/src/java/org/apache/lucene/analysis/kuromoji/KuromojiTokenizer.java
+++ b/modules/analysis/kuromoji/src/java/org/apache/lucene/analysis/kuromoji/KuromojiTokenizer.java
@@ -683,18 +683,18 @@ public final class KuromojiTokenizer extends Tokenizer {
         // Re-base cost so we don't risk int overflow:
         Arrays.fill(leastPosData.costs, 0, leastPosData.count, 0);
 
+        if (pos != leastPosData.pos) {
+          // We jumped into a future position:
+          assert pos < leastPosData.pos;
+          pos = leastPosData.pos;
+        }
+
         if (pending.size() != 0) {
           return;
         } else {
           // This means the backtrace only produced
           // punctuation tokens, so we must keep parsing.
-          if (pos != leastPosData.pos) {
-            // We jumped into a future position; continue to
-            // the top of the loop to skip until we get
-            // there:
-            assert pos < leastPosData.pos;
-            continue;
-          }
+          continue;
         }
       }
 
@@ -955,10 +955,11 @@ public final class KuromojiTokenizer extends Tokenizer {
   // the pending list.  The pending list is then in-reverse
   // (last token should be returned first).
   private void backtrace(final Position endPosData, final int fromIDX) throws IOException {
+    final int endPos = endPosData.pos;
+
     if (VERBOSE) {
-      System.out.println("\n  backtrace: pos=" + pos + "; " + (pos - lastBackTracePos) + " characters; last=" + lastBackTracePos + " cost=" + endPosData.costs[fromIDX]);
+      System.out.println("\n  backtrace: endPos=" + endPos + " pos=" + pos + "; " + (pos - lastBackTracePos) + " characters; last=" + lastBackTracePos + " cost=" + endPosData.costs[fromIDX]);
     }
-    final int endPos = endPosData.pos;
 
     final char[] fragment = buffer.get(lastBackTracePos, endPos-lastBackTracePos);
 
diff --git a/modules/analysis/kuromoji/src/test/org/apache/lucene/analysis/kuromoji/TestKuromojiAnalyzer.java b/modules/analysis/kuromoji/src/test/org/apache/lucene/analysis/kuromoji/TestKuromojiAnalyzer.java
index 4c667e8..c945477 100644
--- a/modules/analysis/kuromoji/src/test/org/apache/lucene/analysis/kuromoji/TestKuromojiAnalyzer.java
+++ b/modules/analysis/kuromoji/src/test/org/apache/lucene/analysis/kuromoji/TestKuromojiAnalyzer.java
@@ -163,4 +163,24 @@ public class TestKuromojiAnalyzer extends BaseTokenStreamTestCase {
                                             KuromojiAnalyzer.getDefaultStopTags());
     checkAnalysisConsistency(random, a, random.nextBoolean(), s);
   }
+
+  // LUCENE-3897: this string (found by
+  // testHugeRandomStrings) tripped assert
+  public void testAnotherCuriousString() throws Exception {
+    final String s = "???????????©ã???????´ã?·ã?????¹ã???°ã?????????¡ã???²ã???¤ã???±ã???????²ã?¿ã?????????????????¨ã?????¹ã???????????¨ã?????????¡ã???¸ã???±ã???¿ã???±ã?³ã???·ã?????·ã?????¥ã???????????????·ã?¼ã?£ã???????£ã?»ã???»ã?¼ã???¸ã?¿ã?????????????????????¸ã?²ã???¿ã?????????????¤ã???µã?????????????????²ã???¿ã?½ã???ºã?·ã???????????????½ã???±ã???¥ã?????¨ã???¨ã?????????¥ã?½ã???°ã???¶ã?????¶ã?¨ã???????????????????????????©ã?©ã???¿ã???????????¾ã?°ã?°ã?¼ã???????°ã?±ã???¹ã???????????´ã?????§ã?©ã???????§ã?¤ã???¨ã?¶ã???´ã?¡ã?????????·ã?£ã???³ã???????????????????????±ã???´ã?µã???????±ã?????£ã?????????????????¼ã?¿ã???????²ã?????????¨ã?©ã?????µã?????£ã???????????¡ã?????????ºã?»ã???ºã???????????¶ã???????????????????·ã?°ã?²ã?????»ã?????»ã???????²ã?ºã?§ã?????????????????????£ã?¨ã?????´ã?»ã?????????³ã???¶ã???????????????©ã???±ã?¡ã???¶ã???????????????????µã?´ã?½ã???±ã???³ã?¶ã?±ã?????????????????????????£ã???¤ã???????????¿ã?£ã?????¹ã???¡ã???·ã???¤ã?´ã???????¤ã?????????¾ã?????????´ã???©ã?¸ã?????????????¼ã?????¾ã???¿ã???§ã???½ã?????»ã???°ã?¨ã?¥ã???????©ã?©ã?±ã???³ã???????????¹ã?³ã?³ã???²ã???£ã?????????????¥ã???¿ã?³ã???????¶ã???????????????????¥ã?????????¹ã?²ã???????????????????????????????????????¹ã???©ã?½ã?????µã?????£ã?????§ã?????°ã?????????????¾ã?£ã???¾ã?²ã???§ã?????²ã?¼ã???????????????????µã???¤ã???¡ã???????¼ã???´ã?¶ã???????²ã?????????????½ã?????§ã???????´ã?????£ã?????£ã?´ã?????????????°ã?????¤ã???¤ã?????´ã?????????·ã???©ã?????³ã???????????????????????????????????±ã???¸ã?¹ã?????¶ã?????¼ã?????¶ã?????????£ã???µã?±ã???¡ã???¹ã???¶ã?????????????¸ã?µã???±ã???????¸ã?©ã???·ã???½ã???????¡ã?¨ã???ºã???§ã?´ã???????¶ã?¼ã?????????????¶ã?¿ã?¾ã?¹ã?????????´ã?????¡ã?????¸ã?¸ã?????£ã???©ã?¶ã???????¨ã???????????¡ã?¾ã???µã???¼ã???´ã?¸ã?????????¡ã?¶ã???????¼ã?±ã?¿ã?????©ã?¡ã???????????????©ã???????£ã???¤ã???¼ã???´ã?¡ã?????´ã???????????????????????¤ã?????ºã???¸ã???¶ã?½ã?????????¶ã???¸ã?§ã???²ã???°ã???????????????????§ã?°ã?¹ã?¾ã???????¹ã???¶ã???????¿ã?©ã???ºã?¡ã?????µã?????¨ã?·ã???????¤ã?¤ã???¸ã?????¹ã???²ã?£ã???²ã???????????¼ã?¨ã???????????¶ã?©ã?????¿ã???©ã?»ã?????¤ã???????·ã?»ã?????????????????°ã?????????£ã???©ã?©ã???????¼ã?¡ã???³ã?¿ã???³ã?¼ã?ºã?¶ã?????§ã???³ã?²ã?????????³ã?????·ã?????¶ã?»ã???????²ã?????¨ã?»ã?????????£ã?´ã???????·ã???????»ã?²ã?½ã?¼ã?¥ã?????????????????????????©ã?¿ã?¹ã???¶ã???????¾ã???½ã???²ã?¤ã?????????¸ã???¸ã?????????½ã?????µã?????²ã?¸ã???????¹ã?¼ã???±ã?????????½ã?¹ã?????¥ã???????????????????£ã?????§ã???????????????°ã???????¨ã???¶ã???????ºã???¡ã???????¾ã?´ã?¸ã?????????????????¡ã?????????¼ã???¨ã?¾ã?????µã???¥ã?????¾ã???¹ã???????ºã?³ã?¹ã???????µã?µã?±ã?????¹ã?ºã?£ã?????????§ã?????????????°ã?????????©ã?£ã?¾ã?ºã???????????????²ã?¸ã?¶ã?§ã?????¨ã?????????²ã???½ã?¡ã?????£ã?????¸ã???¼ã???¿ã???½ã?¤ã?¿ã?¶ã?????¾ã?????±ã???±ã?§ã???????°ã?????¸ã?????????¡ã???¿ã???¼ã???·ã???????????¥ã???§ã???????¡ã?»ã?¨ã?²ã?????????°ã?????§ã???????¼ã?½ã?µã?????·ã?????´ã???????£ã???¥ã?±ã???????????¡ã?£ã???´ã?????????ºã?????????¥ã?¥ã?????¨ã???½ã?¼ã?????????¤ã???????£ã?????³ã?½ã???©ã???¶ã???????³ã?????????¶ã?±ã???????¡ã?????°ã???´ã???????????½ã?????³ã?µã???¨ã???????????¡ã???©ã???????????????????½ã?????»ã?????????©ã???¼ã?¿ã?¡ã???????¸ã?????¼ã???????¼ã???????£ã?????»ã?§ã?????³ã?±ã?¥ã?³ã?????????????§ã?????£ã???¹ã???£ã?¶ã?¡ã?¾ã???????¶ã?§ã?????¨ã???ºã?³ã???????????°ã?±ã?????????©ã?????????£ã?¼ã???½ã???????????³ã?¤ã???¡ã???????????¶ã?????????????????¡ã?³ã?¹ã???????????????¹ã?¿ã?¥ã???????»ã???ºã?????²ã???¾ã???????????????´ã?????¨ã???°ã?»ã?·ã?¿ã?¥ã???¼ã?¹ã?©ã?±ã?????´ã???°ã?????»ã?¾ã???µã?»ã???????»ã?????±ã???¾ã???????????????????»ã?§ã?????£ã???°ã?????¸ã?µã???????·ã???¸ã???°ã?????????°ã???¾ã?????????¶ã?»ã???????????©ã?·ã?´ã???´ã???±ã?????????????¡ã?????±ã?¡ã???¤ã?????????´ã???????¶ã?????¨ã???????µã?¹ã???¤ã???????¶ã?????§ã???©ã?????¤ã???????£ã?±ã?????°ã?????µã?·ã?ºã?¾ã?ºã???????£ã?¿ã?©ã?°ã???????§ã???????·ã???ºã???????¨ã???§ã?????¥ã?¸ã?????¡ã?©ã?©ã?±ã?´ã?????¿ã???????????¹ã?¥ã?²ã?????????·ã???½ã?????³ã???¡ã???????±ã?????????????¡ã???¨ã???????????????????¼ã?²ã?????????¼ã?´ã?¹ã?????ºã???ºã???????¾ã?¿ã???ºã???¤ã???´ã?¶ã?£ã???????¤ã?????¹ã?ºã???????????????????¹ã???¶ã???????¾ã?????????¾ã???????????¶ã?©ã???ºã?????½ã???¸ã?µã?????????°ã???????»ã?????¤ã???ºã?????¨ã???????????¨ã?¸ã???£ã???©ã???§ã?¾ã?????¤ã?????´ã???????¿ã???´ã???·ã???´ã???½ã?????????¶ã?²ã?????¸ã???????¸ã???£ã???²ã???????»ã?¹ã???¶ã?¥ã?????¨ã?????¥ã?½ã???µã?????????³ã???§ã?¼ã???¹ã???¾ã???½ã???¹ã?²ã?????¨ã???¡ã???±ã?????????§ã???¸ã?????????????¸ã?????©ã?¡ã?????????????????¹ã?§ã???¨ã???????²ã???????????????¸ã???¾ã?§ã???????¡ã?¼ã???¨ã?²ã?¥ã?¼ã???»ã?????¸ã?©ã???·ã???????§ã?¿ã?¾ã???????£ã?°ã???????´ã?¨ã???©ã???????¼ã?»ã???????ºã?????µã???²ã???¨ã?ºã???????????¡ã?????¿ã???????????????????»ã?²ã?¹ã???????£ã?????????????¾ã???????????????µã?????ºã?»ã?¤ã?????»ã???¥ã?????????§ã?¾ã???????????·ã???¿ã?????½ã???·ã?????¨ã?¨ã?????½ã?¾ã???§ã?´ã???????????£ã?????ºã???¥ã?¼ã?????????????????????¨ã?³ã???£ã?????????©ã???ºã?????????????????????????´ã???´ã???´ã???????´ã???°ã?????³ã???¾ã?¶ã???¨ã?²ã???©ã?·ã?????????????§ã???³ã???¹ã???????????°ã???¥ã???¸ã?±ã???©ã?´ã?????????³ã???§ã???½ã???????§ã???????¸ã?¤ã???©ã?????????????¨ã???????????¹ã?ºã???½ã?¡ã?·ã???¶ã???¹ã???????????¼ã?°ã???????????¡ã?????¾ã???¾ã???????????¿ã?½ã???????¶ã???????????£ã???????©ã?????????°ã?????¸ã?§ã?ºã?°ã?????¾ã?????????©ã?£ã?????????????¨ã???·ã?????????¶ã???£ã?¿ã???±ã?¾ã?¨ã?¥ã?????³ã?????????²ã???¡ã?¶ã???¤ã???????·ã???¾ã???????³ã?»ã???????£ã???ºã???´ã?³ã???µã?ºã?¨ã???©ã?°ã???§ã?£ã?????¹ã???????????£ã???????µã?§ã?????´ã???±ã?????????¶ã???????????ºã???²ã?????¾ã?·ã?????£ã?¾ã???????????§ã?????????????»ã???£ã???³ã?©ã???????¥ã?»ã???°ã?¼ã?????·ã???????????????????©ã???½ã?±ã???????°ã?¨ã?¿ã?·ã?????????´ã?§ã?»ã?°ã???¶ã?¡ã?¹ã?©ã?¡ã?ºã?²ã?¼ã???©ã?¿ã???????´ã?¼ã???¤ã?????©ã???²ã?????²ã?????¤ã???·ã?§ã???§ã?????£ã?????§ã???????²ã?????©ã?©ã?????????¥ã?¸ã???????¿ã?µã?ºã?¤ã?²ã?????¥ã?????°ã?????©ã???????????¹ã?????????????±ã?????¹ã?¨ã?¿ã?»ã?£ã???¨ã???¤ã?¼ã???»ã?©ã?¶ã?????²ã?·ã???????????????¾ã???»ã???±ã?????¹ã?£ã???????µã?????????????¼ã?????µã???°ã?????????ºã???????????????????¨ã?½ã???????????¤ã???·ã???????????¼ã?????¤ã?????????µã?·ã?????????????½ã???????¿ã?µã?·ã?¤ã?¿ã?????»ã?????????³ã?¸ã???¡ã?¡ã?????»ã???????·ã???¾ã???ºã???¨ã?°ã???³ã?????????????????§ã???·ã?©ã???????????????????£ã?????¸ã?????????¥ã???????¹ã???ºã?¤ã?????????²ã???????????????¼ã?¾ã?±ã?µã?»ã???????¸ã???½ã?´ã?±ã???µã???????³ã???£ã?????©ã???????¨ã?»ã???¿ã?¹ã?????????¹ã?»ã?????´ã?¤ã???????¸ã?·ã?????????????³ã???¹ã???½ã???¶ã?????¤ã???????£ã???¶ã???¥ã?????¸ã?¸ã?¤ã???£ã?????§ã???????»ã?¶ã?¾ã?????³ã?????»ã???ºã???²ã???????¶ã?©ã?????????°ã?????????????¹ã?»ã?????½ã?·ã?±ã?????????¿ã?????ºã???²ã???¼ã?????????©ã???¡ã???»ã???????????????????????????£ã?????????¾ã???´ã???????¶ã???????¿ã?????´ã???¶ã?¡ã?????¿ã?¼ã???µã???»ã?¼ã?????µã?????¸ã?????§ã???¾ã?????????????????????¤ã?????¸ã???????£ã???????¡ã?¨ã???¥ã?????????????¸ã?????????????¾ã???©ã?????????°ã?¸ã?¤ã?´ã?¶ã?¤ã?????????½ã???????????¸ã?????????»ã?????¹ã???¥ã?²ã?????¹ã?????½ã???©ã?·ã???¹ã?ºã?©ã?????????¡ã???¡ã???????ºã?¶ã?¾ã???????¾ã?»ã???£ã???¡ã?©ã?¥ã?¾ã?????¤ã?°ã?????²ã???????½ã???¿ã???????????¼ã?????²ã?????????????????¥ã?????³ã???????¥ã?³ã???????©ã?????¥ã?????¿ã?????£ã?¹ã?????±ã???????????¾ã?¾ã???????·ã???³ã?£ã?????????????»ã?????????????±ã???????????ºã???????????»ã???·ã?©ã?¹ã?¥ã?????????????½ã?±ã?¼ã?´ã?¾ã???¸ã?¿ã?±ã???¨ã?????????¸ã???µã?????????´ã?????????¥ã???????????£ã?¿ã?????????¹ã?²ã?????????????¹ã?´ã?¿ã?¥ã?´ã?²ã???§ã?????¶ã???????????¸ã?????½ã???¸ã?»ã?????±ã???????????????»ã?´ã???????°ã?¾ã?¥ã???¼ã?»ã???????????©ã???????»ã?¡ã?????????²ã???»ã???????±ã?¾ã?·ã???????????©ã?????????????????³ã???µã???¼ã?¨ã?????????¹ã?§ã?????????????¤ã???????½ã?©ã?????²ã???ºã???³ã?¸ã???¸ã?¹ã?¥ã?????????????°ã???????????????¹ã?????¶ã?¾ã?¨ã?¿ã?????¡ã?????¶ã?²ã???·ã?????·ã?????????????????¼ã?????????????©ã?°ã???????µã???????·ã?¼ã?©ã?????????³ã???????????????±ã?±ã???¤ã?½ã?????¤ã?µã?????????²ã???¼ã?·ã?????????³ã?²ã???¥ã???©ã?³ã?¤ã???½ã?½ã?????¶ã?¶ã?¾ã?´ã?°ã?·ã?¨ã?????²ã???µã?²ã?¸ã?©ã???£ã?????????¡ã?¿ã?³ã?????§ã???????¿ã?£ã?????????µã???¶ã???µã???????????²ã?¹ã?¾ã?°ã?°ã???????³ã???????¤ã???????????§ã???????±ã?¾ã???²ã?µã???¼ã?¼ã???¤ã?µã???´ã???µã?????????????????????¤ã?¼ã?±ã???¤ã?¶ã?°ã?????»ã???³ã?µã?¡ã???????©ã?????°ã???¸ã?????????¿ã???µã?ºã?????µã?????´ã?¤ã???????·ã???¡ã?????????????½ã?????????????????¸ã???µã?¾ã???????????£ã???©ã?½ã???????????»ã???·ã???????????µã???·ã???????????????£ã?????¸ã?¶ã???³ã?¾ã???????????????¨ã?ºã???´ã???»ã???¨ã?????±ã???????ºã???????§ã?¿ã?¶ã?²ã?????µã???¹ã?·ã?³ã?????????¡ã???ºã???¡ã?????§ã?ºã?ºã?±ã?????????¡ã???????°ã???¹ã?¥ã?????¶ã???³ã?£ã???³ã?????????¡ã???????????¹ã?¶ã?¸ã?????????????¼ã?·ã?????¤ã?²ã???³ã?´ã?¾ã?????¹ã???????¹ã?????²ã?????¡ã???????????????????????³ã?????¹ã?ºã???²ã?????½ã???±ã???¿ã?¡ã???????????°ã???¥ã???¶ã?????¶ã???¼ã?????¥ã???????????¸ã?³ã?????¡ã?©ã?????¹ã???§ã?¿ã?±ã???¿ã?????¶ã???¥ã???????????????¾ã?????©ã?¥ã???????²ã?????¶ã???¡ã?????¡ã???¼ã?°ã???¾ã?¨ã?????¹ã?????????¸ã???½ã???µã???????¶ã?????????????????§ã?????????¡ã?????»ã?§ã?????±ã?§ã?????????¸ã???©ã???µã?¡ã???´ã?????????´ã???°ã???³ã???´ã?????¨ã?????¿ã?????????¼ã?³ã?¤ã?±ã?????????³ã?£ã?³ã?ºã?????????²ã?²ã???³ã???·ã?µã?¹ã?·ã?¾ã?????¹ã?£ã???¨ã?µã???½ã?????¹ã?»ã?¨ã?????????¨ã???????????¹ã???»ã???????§ã?????·ã???²ã?§ã???ºã???¼ã?³ã???????????²ã???¾ã???¸ã?·ã?¿ã?????±ã?????°ã???§ã???³ã???????????????§ã?????£ã?????µã?°ã???¼ã?½ã???????´ã?²ã?ºã?¾ã?????????©ã???¤ã?£ã?¥ã?????±ã?????´ã???°ã?£ã?»ã?µã?¹ã?¤ã???´ã?????????¨ã?????¡ã???¥ã?????¸ã?½ã?????£ã?????????°ã???????????µã???¹ã???????????¡ã?·ã?¿ã?©ã?¥ã?¶ã?²ã?????§ã?²ã?????????????????°ã?µã???´ã?¿ã???±ã???³ã???????¹ã???»ã???????£ã???¤ã?·ã?????????????±ã?¿ã?????????¤ã?¿ã?????¥ã?»ã???»ã?¼ã?????°ã???????????????»ã?§ã?????????????????????¹ã?????¹ã?????????????????¶ã?ºã?????????³ã?°ã?¶ã?¨ã?????????°ã?·ã???©ã?¨ã???¤ã?»ã???????µã?±ã?¼ã?µã?????§ã?¼ã?¡ã?¶ã?§ã?¾ã???·ã?????§ã?????????????¶ã?±ã???¤ã?»ã?¹ã?±ã?°ã???¨ã?¥ã???????¾ã?½ã???¸ã?????????????????²ã???????±ã???²ã???????±ã???????????¨ã?????½ã?§ã?¥ã???°ã???¥ã???¡ã?¼ã?´ã?²ã???????µã???????????????¾ã?????????´ã?©ã???????²ã???¨ã?????????¥ã?????²ã???????³ã?¡ã?³ã?©ã?????????¨ã???????¼ã?????????µã???????????°ã?¾ã?????¸ã???»ã???????¥ã?????????????¤ã???¼ã???????¤ã???¥ã?¡ã?????????§ã???§ã?ºã???????¸ã?????ºã?¸ã?????????????´ã?¸ã?¤ã???¾ã?????°ã???·ã?½ã?¶ã?¿ã?°ã?????????±ã???????°ã?¨ã?????½ã?»ã?»ã???????¨ã?????£ã?¨ã?¾ã?????????????????????¥ã???¡ã???¾ã?????????¹ã?©ã?????????¾ã?????????£ã?²ã?????»ã???????½ã?¿ã?¼ã?¾ã?????§ã???·ã?°ã?²ã?§ã???¹ã???????»ã?¤ã?????????³ã???????¤ã???°ã?????¨ã?¾ã???????³ã?????°ã???¼ã???°ã?³ã?????¤ã?????½ã???????????½ã?£ã???·ã?????¶ã?·ã?????????????¤ã?¸ã???¡ã???¾ã?????¶ã???µã?¨ã???¼ã???¨ã?¶ã?????????²ã???????¡ã?»ã?·ã?»ã?£ã?°ã???½ã?????²ã?????¸ã?¶ã?¿ã?£ã???????¡ã?????©ã?????????¤ã?????????¨ã???¹ã???????¡ã?§ã?????·ã?????????¤ã?»ã?²ã???????¿ã?§ã???????????³ã?????¿ã?????µã???¨ã???´ã???????·ã?»ã?¶ã?¡ã?½ã?¤ã???½ã?°ã???¾ã?¹ã???³ã???¹ã???´ã???????¹ã???»ã???³ã???ºã???´ã?????½ã?²ã???????????????¨ã???¨ã?´ã?¿ã???»ã???????????ºã?¿ã?¹ã?¤ã?????¸ã???´ã?©ã?????????????????????°ã???¶ã?°ã?????????????£ã???´ã???¿ã?½ã?????????»ã???????????·ã?????³ã???¸ã???´ã???©ã?¸ã?¾ã?¡ã?¼ã?»ã?????¶ã?????¤ã?©ã?¿ã???»ã???????²ã???????????????¸ã?¡ã???±ã???????½ã???????»ã?¿ã???¸ã???¹ã???°ã?¸ã?°ã???????????½ã???£ã?¾ã???¥ã???°ã???©ã?°ã?????????·ã?³ã???????±ã???£ã?????????????¸ã???¤ã?????¾ã?£ã?????³ã?????¼ã?¤ã?????µã?°ã???¡ã?²ã???¤ã?????§ã???????????¶ã?»ã???????¡ã?¿ã?????ºã???????????????¼ã?£ã???????????£ã?????????????¿ã?§ã?µã???´ã?¾ã???????¨ã???¨ã???·ã???µã???¶ã?¼ã?????????????³ã?¶ã???????°ã?????????£ã?¶ã?????±ã?????·ã???¿ã?????????¶ã?ºã?½ã???¡ã?·ã?½ã?²ã?????????µã?¤ã???¤ã?????µã?½ã?????¡ã???????????¥ã?¤ã?????ºã???????????????³ã???¾ã???©ã???????????????´ã???????????????³ã?????¾ã?????????????????????????????????????????¥ã???????¿ã?????°ã?ºã?³ã???????¨ã?¸ã?¼ã?³ã???¶ã?·ã???¨ã?³ã???¤ã?????????¸ã?????°ã???¡ã?»ã?»ã?????????????§ã???????²ã?????±ã?¼ã?»ã?²ã?·ã?????µã?©ã???£ã?»ã?????§ã?°ã?½ã?????§ã?????¹ã???????°ã???½ã?£ã???¥ã?ºã???????????´ã???¾ã?????ºã?¡ã?????????¶ã?????²ã???????¿ã???¥ã?¥ã?¥ã?????????§ã?¾ã???¶ã?ºã???·ã?©ã?£ã?????¿ã?¿ã?°ã???????????£ã???????????¾ã?????½ã???¹ã???¿ã?§ã???µã?²ã?????????§ã?ºã???ºã?ºã?¡ã???³ã?????¾ã?????????????±ã?????£ã???????£ã?µã?¹ã?¥ã?µã???»ã?????µã?????²ã?§ã?????£ã?????°ã???¹ã???????????¶ã?????½ã???»ã?????½ã?????£ã???¹ã???¨ã???©ã?µã???³ã?????§ã???????¾ã???©ã???´ã???¼ã???¨ã?µã?¥ã?´ã???????£ã?§ã???????????????????·ã?ºã?¼ã???¡ã???????¿ã?¥ã?¾ã???????????????????????³ã???????»ã?§ã?????°ã?²ã???·ã?????????²ã?²ã?¸ã?³ã?????µã?°ã?????????¨ã???¶ã?»ã?»ã?©ã???????´ã?¨ã???????¿ã?????????¹ã???³ã?¼ã?²ã???????µã?²ã???????µã???????¶ã???????±ã?????§ã???????????????????????????¤ã?©ã?????????¿ã???§ã???¶ã?????????????¶ã???????????½ã?¡ã?¸ã?°ã???????¾ã?¼ã???¥ã???¸ã?????¸ã?????????????????????ºã???????¾ã?¹ã?ºã?????½ã???????½ã?????»ã???¼ã???????????¼ã???´ã???????????????°ã?¹ã?¶ã?ºã???¨ã?????????????¿ã?²ã?????????????????¨ã?»ã???????¥ã?¾ã?´ã???¹ã?????ºã???°ã?????´ã?±ã?????¾ã?£ã???¥ã?????©ã?¶ã?????¸ã???¼ã???¶ã?????½ã?¼ã???????????????¡ã???¹ã?ºã?????¸ã???¤ã???¸ã???©ã?¼ã???????????³ã?¿ã?????????©ã???????????????????????????§ã?¶ã?????¶ã???????½ã?????¡ã???????¶ã???¹ã???¨ã?·ã?©ã?§ã?????µã???°ã?????§ã???¥ã???????¤ã?¥ã?§ã?§ã???????????????????????·ã?§ã?·ã???ºã???©ã?·ã?¡ã?????????½ã???????????´ã?¨ã???¥ã?????¼ã??";
+    final Analyzer a = new KuromojiAnalyzer(TEST_VERSION_CURRENT, null, Mode.SEARCH,
+                                            KuromojiAnalyzer.getDefaultStopSet(),
+                                            KuromojiAnalyzer.getDefaultStopTags());
+    checkAnalysisConsistency(random, a, random.nextBoolean(), s);
+  }
+
+  // LUCENE-3897: this string (found by
+  // testHugeRandomStrings) tripped assert
+  public void testYetAnotherCuriousString() throws Exception {
+    final String s = "???§ã?·ã???????½ã?£ã???????¾ã?????????????½ã???????????·ã?·ã???¨ã?¸ã???¾ã?¨ã?ºã???????²ã?????????¾ã???»ã?????µã?£ã???©ã?±ã???¨ã?¸ã?????¹ã???»ã?¥ã?????²ã?ºã?????»ã?·ã?½ã?ºã???????©ã???????????³ã???µã?????¡ã?????????????±ã?????ºã???¼ã???¤ã?¤ã?????¶ã?????³ã???ºã???ºã?ºã?¤ã?©ã?²ã?????±ã?????¤ã???»ã???»ã?¹ã?????????????ºã???????²ã?????²ã?´ã?¡ã???¿ã???????¤ã?????¿ã???????????????¥ã???·ã?°ã???¨ã?ºã?§ã???????§ã?????????§ã???¨ã?ºã?£ã???ºã???½ã???????????¼ã???¨ã???¹ã???¹ã?©ã?³ã?????????°ã???³ã?¤ã?©ã???¶ã???????????½ã???????´ã???????????????¸ã?·ã???????³ã?????????????????»ã?¶ã?????????????¨ã???¹ã???¨ã?µã???¡ã?????¤ã?????²ã?¨ã?³ã???§ã?¸ã???´ã???????????¨ã???????ºã?¨ã???²ã???????µã?????´ã?°ã?¨ã?ºã???????????¨ã???¥ã???????ºã?????????°ã?????¥ã???????¼ã???©ã?????©ã???¤ã???????¨ã???£ã???¿ã?????©ã?????¡ã???§ã?????¨ã?¹ã???ºã?¿ã?????????´ã???¥ã???????©ã?????????¹ã?§ã???¿ã???°ã?µã???????¨ã???¨ã???????¸ã???´ã???§ã?????±ã???????²ã?????©ã???¹ã?£ã???µã?³ã?µã?????·ã?????????²ã?????????§ã?????´ã?¤ã?????°ã?????????????½ã???¾ã?»ã?·ã?¶ã???????????????£ã???????????±ã?????????????¸ã???????²ã?µã?????¿ã???£ã?????³ã?¾ã?????³ã???????°ã?´ã???????¿ã???????©ã???????????¶ã?©ã?????????¥ã?????´ã?·ã???????????²ã???¹ã?´ã?²ã???£ã?µã?§ã?¡ã?¾ã???¡ã?£ã???????????????¡ã???¹ã?£ã?°ã???µã?????²ã?§ã???½ã???ºã?????µã???½ã?»ã?????????µã?²ã?ºã???¼ã?»ã?????????????????¥ã???????????·ã???¥ã?¥ã?????¶ã?¿ã???????????????????£ã???????????©ã???¾ã?????©ã?????°ã???§ã?????¸ã???ºã?¼ã???°ã???©ã?©ã?¹ã?£ã?????¸ã???????°ã?¹ã???µã???????¼ã?????¸ã?£ã???¾ã?°ã???´ã?¥ã?´ã?¤ã???¿ã?¡ã?³ã?????©ã?¡ã???»ã???¤ã?????????????´ã???????????????????¼ã???§ã?????????????????£ã?°ã???????£ã?¿ã?????¾ã?±ã?????????????¥ã?¡ã?????????????¼ã?¶ã?¸ã???¹ã???????????????³ã???©ã???¿ã???µã?????????????¼ã?????·ã???¨ã?°ã?µã???¤ã???¾ã?????????¥ã?½ã???????¤ã???³ã???????¤ã?²ã???±ã?????´ã???????????¸ã?¹ã???±ã???????????????¼ã?????????¾ã?·ã?¥ã?????²ã???²ã???????????¸ã?¸ã?¹ã?¾ã?°ã?????¨ã?¤ã?????????³ã???¤ã?????³ã?ºã???²ã?½ã???¥ã?????¹ã?????¹ã???????????¶ã?§ã???»ã?????????¤ã?¡ã?±ã?????????½ã???¥ã?¨ã?????ºã?³ã?????????¹ã?????????¸ã?»ã???¥ã?¤ã?»ã???????????ºã?¿ã???????????©ã???½ã???????????¥ã???¨ã?????????????????½ã???§ã?¼ã???????¶ã???°ã?????§ã???¹ã?????¼ã???¸ã?¼ã?£ã?¡ã???©ã???¼ã???²ã?????????????¥ã???????¡ã?²ã?¾ã???????????????????ºã???¨ã?¤ã?????????³ã???????¥ã???¿ã???¸ã???????¡ã???????????????£ã?²ã?´ã???²ã???½ã?????²ã???????²ã???????²ã???°ã?¨ã?©ã?±ã?????©ã???????????ºã?±ã???????????????¹ã?³ã?¸ã?????§ã?·ã???¹ã?¥ã?¾ã?¨ã???????????????¥ã?????§ã?¹ã?½ã???ºã???????????????´ã???¤ã???·ã???³ã?????¤ã?£ã???????????????©ã?????»ã?????????½ã???§ã?????ºã???????????????´ã???½ã?´ã???°ã?±ã?????????????????·ã?????¨ã?????´ã?·ã?¿ã?»ã?´ã???????????????????????????¤ã?????¨ã?£ã???¶ã?¥ã???????????????µã???¼ã?¸ã???¾ã?¥ã???²ã?????????¡ã?????µã?¡ã?????¾ã???????¡ã???????????µã???¹ã?°ã?´ã?????¶ã?????????°ã???¶ã?µã?¨ã?¾ã?????»ã?µã???????¾ã???¡ã???¼ã???¤ã?ºã???¨ã?????????????????ºã???????¸ã???°ã?????????????????¡ã?¨ã???§ã?????¥ã???¼ã???¼ã???¸ã???µã?¼ã?????½ã?¹ã?¨ã?????³ã?½ã???µã?½ã?¸ã?·ã???¿ã???©ã???ºã?³ã?????¹ã???¼ã???????·ã?????????¾ã???????¥ã???¤ã???????¹ã?????¡ã?±ã?????°ã?¾ã?????£ã???°ã?¹ã?¾ã?????²ã???????¤ã?¿ã?¶ã?±ã?¾ã???½ã?¤ã?°ã?????????¤ã?°ã?¼ã?????°ã?¸ã???????µã?????¤ã?²ã?±ã?¨ã?µã?´ã???¹ã???§ã?????¶ã?????ºã???????²ã?¡ã?????¹ã?????????¥ã???»ã?????¨ã?§ã?³ã?????¿ã?????½ã?¥ã?????£ã?¿ã???²ã?¶ã???????????´ã?????¶ã?½ã?????????????¤ã???????????§ã?¡ã?¸ã?¸ã???¸ã???¹ã???§ã?¡ã???¡ã?????´ã?´ã?³ã?¶ã???±ã?????ºã???¼ã?¾ã?±ã?????¤ã???§ã???????§ã?????©ã???»ã?¤ã?©ã???³ã?????????·ã?¥ã?????³ã?¸ã?????????¿ã?»ã???³ã???¸ã?????¡ã?????¶ã???¡ã???¾ã?¥ã???????¹ã?????????????¥ã???³ã???????¥ã?»ã???¾ã???????????????¹ã?·ã?????????¾ã?????ºã?»ã?¨ã?¼ã?????¾ã?£ã?´ã???©ã?´ã???????©ã?????§ã?µã?¾ã???£ã???¥ã???£ã?????????²ã?§ã???¸ã?¸ã?????¹ã???¤ã?½ã?°ã?????©ã???¹ã???¸ã???¹ã?????¶ã???¤ã?³ã???¾ã?¨ã???©ã?±ã?¡ã???±ã?????¶ã?????±ã???????£ã???²ã?½ã?????»ã???¥ã?????¤ã???°ã???µã?¹ã?????µã???????¤ã?????¥ã?µã?¸ã?????³ã?????¤ã?£ã?±ã?§ã???????????????·ã???°ã?µã???????????¼ã???????????????¨ã?¹ã?¸ã???·ã???????????????©ã???????¾ã?·ã???????µã?????µã???»ã?¨ã?°ã???????°ã?½ã?????¸ã?£ã?????????????±ã???????±ã???²ã?©ã?¥ã???????ºã?£ã?¶ã?¨ã?????????¹ã???????¶ã?¡ã?????????????½ã?¤ã?????»ã?£ã?§ã?±ã?¿ã?µã?????????????©ã?¼ã?????»ã?????¤ã?????????????·ã?????¼ã???????¤ã???????´ã?????????±ã?????????????°ã?????¹ã?¶ã?·ã?¿ã???????????????¹ã?????¿ã???¸ã???????±ã?????¥ã?£ã?©ã?¥ã?????¤ã???????¿ã?ºã?????³ã???§ã???????????????³ã???³ã?©ã???????¼ã???²ã???©ã???????¸ã?¿ã?????????¾ã?????©ã?¸ã???¾ã???????????£ã???¡ã???£ã?????¤ã?????¸ã???????¼ã???¤ã?¸ã???¿ã???¤ã???µã?¥ã???????????¸ã???????¶ã?¾ã???·ã???¼ã?½ã?¤ã?¨ã?????»ã???¶ã?¿ã?¾ã?¨ã???¤ã???¾ã?????¤ã?????ºã???¸ã?¼ã?????·ã?????£ã?¤ã???£ã?±ã?????ºã?????¤ã?¹ã?¡ã?????²ã?¿ã?????¡ã?????????????¶ã?????????½ã?¼ã?¼ã???¿ã???????°ã?¡ã?¿ã???????????????¶ã?????????¡ã???????µã?¤ã?§ã?????????????¸ã???¤ã???»ã???????·ã?????¨ã?»ã?????¡ã?¸ã?????§ã?¹ã?????????¾ã?????ºã?½ã?·ã???ºã???ºã???????????????¶ã?ºã?£ã???????¾ã???£ã?¼ã???·ã???½ã?¤ã?¶ã?????»ã???½ã?????????????????·ã?¼ã?²ã???????´ã?????????§ã?»ã?????????¾ã?????´ã?·ã?????¿ã?????¸ã?©ã?»ã???»ã?????¤ã?????§ã???¾ã?ºã?????µã?¸ã?????¡ã?·ã?????ºã?????¶ã???£ã?»ã?????????ºã???·ã?ºã?¹ã???³ã?ºã???????????????¸ã?????¾ã???????????????????µã???©ã???ºã?????????µã???????½ã???????¨ã???????????????????´ã???¡ã???±ã?????????µã???»ã?????²ã?????????????±ã?°ã???????¤ã?´ã???¾ã???????????²ã?»ã???°ã?¥ã???????????????¤ã???????§ã???³ã???¿ã?ºã???????????¤ã?????¾ã?µã?²ã?¸ã?????????ºã???£ã?¶ã?????????³ã?½ã?????????½ã?¨ã?¸ã?????????¤ã???????ºã???£ã???½ã???¿ã???¥ã?µã???²ã?????³ã???¼ã???¡ã?????????¥ã?ºã???±ã???ºã???????»ã?¥ã?????????¼ã???¼ã?µã?????¥ã?????µã?????©ã???°ã?????????????????¤ã???´ã?©ã?¹ã?¶ã???°ã?¡ã???¤ã?¹ã?????£ã?????´ã?????????¤ã???©ã?????????????????????????????????¤ã?¿ã???????»ã?????¤ã?¼ã?³ã?¹ã???µã?¾ã?????????????¤ã?£ã???°ã?¨ã?????²ã?????????¡ã???±ã?²ã???????????????????©ã?????????????²ã?£ã?¡ã?¶ã?????²ã?µã???¶ã?°ã?????½ã???°ã???»ã???????©ã?????????¤ã???¼ã?¶ã?³ã???????¸ã?²ã?????³ã?ºã?????ºã?????¨ã?¡ã?¡ã???·ã?????????©ã?¨ã?????????????????ºã???·ã???????±ã???¼ã?¸ã?????????ºã?????²ã???????±ã?????????¸ã?³ã?????¨ã???¥ã?????§ã?¼ã?????????§ã?¡ã???????????¼ã?????????????²ã?????ºã?????????¼ã???????ºã???©ã?±ã?????????±ã???³ã???¼ã???´ã?????????¡ã?°ã???¤ã?¥ã?²ã?????¥ã???????¶ã?¤ã???»ã?¡ã?????????½ã???????¾ã???°ã???µã?????´ã???????????????±ã?????¶ã?????»ã???½ã?¶ã?¼ã?ºã?·ã???¶ã???????»ã???³ã?£ã???????³ã?????????¾ã???????????±ã???³ã?¨ã?°ã?¡ã?¸ã???£ã???¤ã???±ã???????½ã???????????????????????°ã???????£ã?½ã?????????¥ã???§ã?¨ã?±ã?¡ã?¸ã???£ã?????????????¶ã???´ã?°ã?????±ã?±ã???¶ã???????????´ã?¶ã?»ã???§ã?¡ã?³ã???§ã???£ã?????¼ã???????·ã?£ã?©ã???????©ã???????????????????©ã?????µã?©ã???¿ã?»ã?????¼ã?²ã?°ã???¨ã?????????ºã?¹ã?¸ã?????§ã?????³ã?????¹ã???¡ã?¼ã?????´ã???????»ã???´ã?£ã?????§ã?£ã?µã?¼ã???¾ã???¼ã?£ã?????½ã???µã?????????¹ã???????¨ã?????¸ã???µã?¨ã?????§ã?¸ã?????±ã???????¤ã???°ã???????©ã?½ã???¸ã?????µã?»ã?????°ã?????????????????????????§ã?¿ã?§ã?¨ã?µã?¾ã?????????????¸ã???????????????µã???¼ã?????»ã???§ã?¤ã?¶ã?¹ã?¼ã?©ã?????£ã???¿ã???´ã???ºã???¤ã???²ã?????????°ã?¿ã???????????»ã?´ã???©ã?¨ã?¤ã???©ã?????³ã???£ã???????????´ã?±ã???µã?????????????????¸ã?°ã???¡ã?¿ã???????????²ã???§ã???????????°ã?????±ã?¨ã???¨ã?½ã?¸ã?½ã?¶ã?£ã?????????????´ã???????¥ã???»ã?????´ã???¨ã?????¤ã?????°ã?©ã?£ã?£ã?¸ã???????????¹ã?·ã?³ã?????·ã???????¼ã???¤ã???????????£ã???ºã?½ã?½ã?±ã?¤ã???????£ã???½ã?????»ã???¿ã?????±ã?????????¸ã?·ã???????¹ã?????¹ã?¶ã???µã?????²ã???¹ã???????¥ã???¸ã?????§ã?±ã???°ã???????????¼ã???????????½ã???????²ã?¥ã???´ã???????????¼ã?????¼ã?????¿ã?¶ã?????»ã???¥ã???µã???????????????¹ã?¾ã?µã???¤ã?¿ã?£ã???????????©ã?´ã?????????¥ã?¥ã???²ã?????¤ã???????????????????????????½ã?¨ã?¹ã???§ã?·ã???´ã?????·ã???????·ã?????²ã???¸ã?¸ã???¹ã?????¨ã???£ã?????´ã???????²ã???????????????????????µã?¸ã?????????????¸ã???µã???¥ã?¨ã?????????¾ã???µã???¾ã???±ã?¹ã???????¡ã???©ã???????±ã?????±ã???????£ã?????¡ã???£ã?????????¿ã?¤ã???¼ã???²ã?????¿ã???????????????´ã?????±ã?¤ã?¹ã???±ã?¶ã?????´ã?¶ã?£ã?????????²ã?±ã?¿ã?³ã?????????°ã?????¼ã?°ã?????°ã???????»ã?????©ã???±ã?????»ã?ºã?¸ã?¾ã?¤ã???¸ã?¥ã?½ã?¼ã???¤ã?£ã???????¡ã?????¸ã???????????´ã?????´ã???£ã?²ã???³ã?¸ã?????£ã?µã???¿ã?????¿ã???¾ã?????¶ã?????????¹ã???·ã?½ã?·ã???????²ã?¿ã?µã???????????????????½ã?????½ã???³ã?????»ã?????²ã?°ã???????????¥ã???????????³ã?¾ã?£ã???ºã?·ã?????????¼ã???§ã?»ã?????³ã?????¾ã???¸ã???½ã???????½ã?»ã???????½ã???´ã???????????????¾ã?¨ã?????»ã?°ã???????????¿ã?????¹ã?????????????µã?????´ã?????¸ã???????????£ã?²ã?¤ã?¾ã?¿ã?½ã?²ã?¥ã???¥ã???³ã?³ã?¼ã???????¼ã???©ã?????????²ã?¡ã?³ã?????¥ã?????????³ã???????§ã???¡ã?¤ã???²ã?????¶ã?·ã???????±ã?½ã?????¸ã???????????????????³ã?¸ã???¸ã???¹ã???????????²ã?²ã???????±ã?????????????¿ã?????????£ã?????????§ã???¹ã???????¸ã?¾ã?????ºã???????»ã?????»ã?±ã???´ã?????????????¡ã???¤ã?????????µã?????????????????´ã?????¾ã???¹ã?´ã?¼ã?????????????¥ã?¸ã?»ã???½ã???¤ã?????¶ã???¤ã???°ã?¨ã?±ã???¨ã?¼ã?±ã???£ã?????¹ã?????¼ã???????????¤ã???¼ã?¤ã?¼ã?¥ã???²ã???????????????¸ã?????¸ã?µã?????§ã???½ã?¹ã???????????¸ã???????ºã?????????¶ã???????????????¶ã???????ºã?¸ã???¥ã???¾ã?????±ã???¤ã?³ã?????¼ã???????½ã???³ã?°ã???¥ã?????ºã?·ã?²ã?????????????§ã?³ã?£ã?????§ã???¥ã?¾ã?»ã?³ã?ºã???¥ã?¥ã?¼ã?????ºã?????£ã?¥ã?²ã?????????¾ã?±ã?¼ã???????????½ã?¹ã?µã???????µã?°ã?©ã?????????????????????·ã???¶ã???????????????¸ã?¸ã???????°ã?±ã?ºã?????¿ã?¹ã?©ã?????¾ã?????²ã?¾ã???³ã?¨ã???????????ºã?§ã?¡ã???????©ã???¶ã???£ã?¨ã?¶ã?©ã???ºã???????¼ã???°ã???¡ã?¼ã?????????½ã?????????????½ã?????????????¨ã???¶ã?´ã?????µã???¨ã?????????????????³ã?ºã?²ã???????´ã?¼ã?»ã?¤ã?????¨ã?§ã?????¾ã???????????§ã???¶ã?¿ã???¤ã???????´ã?°ã?·ã?½ã???±ã???©ã?½ã?ºã?????????´ã???³ã???????????????????????¤ã?¨ã?²ã?????????°ã?????·ã?¥ã???¡ã?³ã???¾ã?????????¡ã?´ã?¹ã?»ã?????°ã?»ã???£ã???¤ã?¤ã???©ã?§ã?????????ºã?ºã???¿ã?¹ã?????±ã???????½ã???????£ã?????´ã?????????????·ã?§ã?´ã?????³ã???¸ã?´ã?¿ã?¥ã???????????????????¾ã???????????????????????µã?¥ã?????¡ã?°ã???µã?????½ã?¥ã?¿ã???©ã???????´ã?????¸ã???¡ã?£ã?§ã???????´ã?????½ã???¸ã?¼ã???±ã?¨ã???????????????»ã?¹ã???????»ã?±ã?¥ã???½ã?¾ã???????¿ã???´ã???²ã???°ã?????²ã?¼ã?????????²ã?µã???£ã???????ºã?°ã???»ã???¨ã?????¥ã?µã?¹ã?????????????????¹ã?½ã?????¹ã?·ã?????§ã???????????????????¼ã???°ã???????????¹ã???¤ã?©ã?????????°ã???????????????????¡ã???»ã?????µã?????¹ã?????µã???¼ã?????????ºã?´ã???????????????????????¸ã???»ã???¤ã?????©ã?½ã???µã?¨ã???????????¨ã?????????¿ã???¥ã?±ã???©ã???£ã?????¿ã???????????????©ã?¶ã???¥ã???????????¾ã?¸ã???²ã???????¡ã???»ã?·ã?????????¹ã???????²ã?????????µã???????¥ã?????????¥ã?±ã?????????§ã?ºã?»ã?????³ã???³ã?¾ã?²ã?²ã???????????§ã?¿ã???????????¸ã?½ã?????½ã?¿ã?????ºã?¥ã???????????????????´ã?¾ã?¸ã???????????????ºã?????©ã?????´ã?????????§ã???????????²ã???????´ã?£ã?¼ã?¨ã???©ã???¼ã?????????´ã?????¤ã?ºã?????????§ã???¤ã?§ã?£ã?????µã?????µã???????µã???¶ã?³ã?¤ã?ºã?¨ã?£ã???¤ã?????ºã?·ã?????µã???»ã?????????????????¶ã???????½ã?¤ã?????????½ã?©ã???????·ã???©ã???????????????????¿ã?°ã?¶ã???±ã???????????§ã???????????¹ã?°ã?????¹ã?????????µã?????£ã?????²ã???????????¸ã?¹ã?©ã???³ã???¥ã?????????????????¾ã?????????¹ã???¾ã???¸ã???·ã?¥ã???ºã?¾ã???????????»ã?¡ã?????????????¨ã?¼ã?????????????????????????¤ã???????¤ã?·ã?µã?³ã?¤ã?½ã?????¥ã?´ã???????¥ã???????§ã???¡ã?????·ã???£ã?????????¾ã?£ã?µã?°ã?????????????©ã?????·ã?©ã?????¿ã???²ã???³ã???????´ã???½ã?????±ã?§ã?????»ã?ºã???????²ã?????????????????µã???°ã?????¸ã?¼ã?£ã???²ã???¤ã???·ã???°ã???³ã?³ã?????????ºã?¤ã?¿ã?²ã?©ã???¡ã?§ã?²ã?§ã???½ã???°ã?¥ã?§ã?´ã?????????????¨ã?????¸ã?¡ã?????¤ã?????»ã?»ã???£ã???¸ã???¸ã?¸ã?·ã???????»ã?¤ã?????¾ã?????????????????????????¹ã???½ã?????????¼ã???????¹ã?½ã???½ã???????ºã?????¨ã?°ã?¸ã???²ã?????¹ã?³ã?¤ã?½ã?´ã?´ã?°ã?³ã?·ã?????¼ã?½ã???????¡ã???¶ã???¥ã?????´ã?µã???·ã?³ã?¥ã???³ã???©ã???????????????¾ã???¨ã?¥ã?????????¨ã?½ã???????¼ã???¡ã?????©ã???????????????ºã?????½ã?±ã?³ã?¡ã???????¼ã???????¹ã???????¥ã?¨ã?????????¥ã?²ã?????¹ã?¥ã?¶ã???¥ã???????²ã?????©ã?????¨ã?¸ã???????²ã?????»ã???¶ã?£ã?¸ã?µã?©ã???¾ã???³ã?¾ã???µã?¥ã?????³ã?¡ã???¾ã?¤ã?¶ã???????????????©ã?????????????°ã?§ã?¡ã???µã?¥ã?µã?????³ã?µã?????±ã?????°ã?´ã???±ã?¿ã?¾ã?´ã???¥ã?§ã???????????¿ã???¾ã???????·ã???????»ã???????¾ã???¿ã???¥ã?????¼ã???´ã?¹ã?¸ã?»ã?µã???????·ã???????????»ã???´ã?????ºã?????????????????????¼ã?????°ã?¿ã???¾ã?????µã?´ã???????¹ã?????¹ã?°ã?¤ã?????????????????????¿ã???³ã???©ã?¿ã?§ã?µã???¾ã?¤ã???©ã???????????????????????·ã?????µã?¾ã???ºã???§ã?»ã?????????»ã?¹ã???????????????ºã???????±ã???»ã?????±ã?ºã???????¿ã???°ã?¸ã?????´ã???¨ã?????£ã???????¡ã???¼ã?????µã???????³ã???²ã?³ã?¼ã?????½ã???±ã?ºã???±ã?½ã?????¹ã?¨ã???????????¤ã???ºã???´ã?°ã?????°ã?¿ã?¹ã?³ã?????????§ã???¼ã?????????¶ã?????±ã???????ºã???µã?????¡ã?§ã?²ã???????³ã?¥ã?©ã?±ã???????????????????»ã?¤ã?????????²ã?????·ã?????³ã?°ã???????¥ã?????????????©ã???????¿ã?????£ã???¡ã?????³ã???????¸ã?¼ã???°ã???????²ã???¡ã?·ã?¥ã???´ã?????¤ã?????????????½ã???°ã???¡ã?¨ã?????¹ã???§ã?????????³ã?????²ã???£ã???????±ã???·ã?ºã?»ã?????©ã?????±ã?´ã?????°ã???????????¤ã?¿ã?????¤ã?±ã?????·ã?¡ã?¡ã???????¿ã???¤ã?³ã???????»ã?????»ã?????¿ã???¶ã???¾ã???½ã?¸ã?????°ã?????????»ã???????????´ã?°ã?¶ã?ºã???£ã???©ã?²ã?¡ã?´ã?????©ã???????¼ã???±ã?»ã?©ã?????¿ã???±ã?§ã?????¶ã???¿ã?????»ã?´ã?????????????????¼ã???°ã???????²ã???¨ã???£ã???°ã???????½ã?§ã?????³ã?©ã?ºã?³ã?????????????´ã???½ã?£ã?£ã?¾ã?½ã?©ã?²ã?????°ã?©ã???§ã?????´ã?´ã?´ã?¨ã?????????£ã?ºã???????·ã?????¤ã???????????§ã???????§ã?©ã?????????¡ã???????????¾ã?©ã?????¼ã???¾ã???¤ã?¾ã???????????¾ã???²ã?????????½ã?³ã???????¿ã?½ã?©ã?????¨ã?????????????????¾ã?????¼ã???????????????????±ã?¹ã?????????????¹ã?§ã?³ã?±ã?????????©ã?´ã???????????¿ã?©ã?·ã?¾ã?´ã?????¼ã???????¤ã???¥ã?°ã???»ã???????³ã?µã?????°ã???¶ã???????»ã???½ã?????????????£ã?¿ã?????????µã?½ã???³ã???¨ã?©ã?????µã?¸ã?»ã?²ã?????¥ã???????°ã???????????£ã???´ã?????²ã???·ã???±ã?°ã?????¶ã???????????¶ã???????»ã???°ã???±ã???????????????±ã?????????¤ã?????µã?¶ã???????³ã?????½ã?????????¾ã?¶ã???¶ã?????????????¨ã?¨ã?£ã?????µã???????£ã???????????????????¨ã???????»ã???????????¡ã?¡ã???»ã???????????????????¨ã???¿ã???????????????»ã?????µã?????????????±ã?¸ã???¶ã???????????»ã???²ã?????¼ã?????±ã?¡ã?????????£ã???³ã?¥ã???¡ã?¡ã???????¡ã???·ã???????£ã???¼ã???????¡ã???½ã?»ã?½ã?³ã?????µã???½ã???¥ã?¾ã?????¿ã???´ã?·ã?¥ã?¡ã?°ã?¹ã?°ã???ºã?????????¾ã?½ã???´ã?????????³ã???¡ã???©ã?¥ã?¾ã???¨ã?????????¤ã?????¸ã???£ã???°ã???????µã???????????µã???????£ã???¼ã???????????????????ºã?½ã?????©ã?´ã?µã?¹ã?¿ã???¥ã???©ã???¤ã???????½ã?¨ã???????½ã???©ã?????ºã?¶ã?¸ã?????????¥ã?£ã?»ã?????½ã???????????????¾ã?¼ã?·ã?????¥ã???????????????????¹ã?©ã???¡ã?????????¨ã?¡ã???????¼ã?????»ã???????????§ã?????¾ã???????¶ã???????¥ã???????¨ã?¸ã???????¨ã???¾ã???¾ã???????????¼ã???????±ã?????????¾ã?????µã?¿ã???¸ã?·ã?µã?©ã???????¼ã???§ã?»ã?¥ã?°ã???¤ã???°ã???¡ã???????????½ã???????????µã?????¾ã?¼ã?½ã???£ã?????????¸ã?????²ã?????°ã?´ã???½ã???·ã?¸ã???????¾ã?¨ã???????¤ã???????¨ã?????´ã?½ã?²ã???????????????±ã???¨ã?½ã?????·ã???????µã?©ã???¡ã?????¹ã???§ã???????´ã?????????»ã?£ã?¸ã?????»ã?????????³ã???????????¸ã???¶ã?¥ã???¨ã???¡ã?????????±ã???¸ã?¼ã?ºã???????????°ã???§ã?????????³ã?¼ã?????????????§ã?©ã???´ã???ºã???°ã?·ã???©ã???????°ã?¶ã???²ã???¥ã?????½ã?µã?±ã?????????????????¥ã?????±ã?¹ã?????????²ã?????????·ã?????????????????????¨ã?????????²ã?¨ã?????»ã?¿ã?????????¼ã???¡ã???§ã?????·ã?¸ã?°ã???°ã?????????????ºã???±ã?????½ã?????¥ã???????????????£ã?´ã???????°ã???????????¾ã???????¡ã?????????¥ã?¥ã???¶ã?????µã?£ã???¨ã???©ã?¹ã???§ã???ºã?????¡ã???????¿ã???¹ã?²ã?????????°ã???????????¾ã?±ã???????????¹ã?¿ã?¿ã?±ã?????³ã?°ã???????????????±ã?????·ã?¸ã???²ã???¶ã?·ã???©ã???????????????????????????¼ã?????¤ã?????????????¤ã?????????ºã?¿ã?¹ã???????????£ã?????µã?¸ã???§ã?»ã?ºã???§ã????";
+    final Analyzer a = new KuromojiAnalyzer(TEST_VERSION_CURRENT, null, Mode.SEARCH,
+                                            KuromojiAnalyzer.getDefaultStopSet(),
+                                            KuromojiAnalyzer.getDefaultStopTags());
+    checkAnalysisConsistency(random, a, random.nextBoolean(), s);
+  }
 }

