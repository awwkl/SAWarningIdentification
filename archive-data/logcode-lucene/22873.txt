GitDiffStart: d4e406ad2299394c0b49563487385f2847700bde | Tue Mar 13 20:50:56 2007 +0000
diff --git a/CHANGES.txt b/CHANGES.txt
index a78dcc8..89135fd 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -66,6 +66,10 @@ Bug fixes
     is consumed. Now a ParseException is thrown if a query contains too many
     closing parentheses. (Andreas Neumann via Michael Busch)
 
+ 9. LUCENE-814: javacc build targets now fix line-end-style of generated files.
+    Now also deleting all javacc generated files before calling javacc.
+    (Steven Parkes, Doron Cohen)
+
 New features
 
  1. LUCENE-759: Added two n-gram-producing TokenFilters.
diff --git a/build.xml b/build.xml
index e62c6d6..c084554 100644
--- a/build.xml
+++ b/build.xml
@@ -287,12 +287,15 @@
 
   <target name="clean-javacc">
     <delete>
-      <fileset dir="src">
-        <include name="java/org/apache/lucene/analysis/standard/StandardTokenizer.java"/>
-        <include name="java/org/apache/lucene/queryParser/QueryParser.java"/>
-        <include name="java/org/apache/lucene/queryParser/CharStream.java"/>
-        <include name="demo/org/apache/lucene/demo/html/HTMLParser.java"/>
-        <include name="demo/org/apache/lucene/demo/html/SimpleCharStream.java"/>
+      <fileset dir="src/java/org/apache/lucene/analysis/standard" includes="*.java">
+        <containsregexp expression="Generated.*By.*JavaCC"/>
+        <exclude name="ParseException.java"/>
+      </fileset>
+      <fileset dir="src/java/org/apache/lucene/queryParser" includes="*.java">
+        <containsregexp expression="Generated.*By.*JavaCC"/>
+      </fileset>
+      <fileset dir="src/demo/org/apache/lucene/demo/html" includes="*.java">
+        <containsregexp expression="Generated.*By.*JavaCC"/>
       </fileset>
     </delete>
   </target>
diff --git a/common-build.xml b/common-build.xml
index 4616eb7..8e6032e 100644
--- a/common-build.xml
+++ b/common-build.xml
@@ -307,6 +307,9 @@
           debuglookahead="${javacc.debug.lookahead}"
           javacchome="${javacc.home}"
       />
+      <fixcrlf srcdir="@{outputDir}" includes="*.java">
+        <containsregexp expression="Generated.*By.*JavaCC"/>
+      </fixcrlf>
     </sequential>
   </macrodef>
 
diff --git a/src/java/org/apache/lucene/analysis/standard/ParseException.java b/src/java/org/apache/lucene/analysis/standard/ParseException.java
index 8fa1f39..5165cb1 100644
--- a/src/java/org/apache/lucene/analysis/standard/ParseException.java
+++ b/src/java/org/apache/lucene/analysis/standard/ParseException.java
@@ -1,6 +1,9 @@
 /* Generated By:JavaCC: Do not edit this line. ParseException.java Version 0.7pre6 */
 package org.apache.lucene.analysis.standard;
 
+/* Note: This file was also manually modified. 
+ * Regenerating it by JavaCC might undo these changes!. */  
+
 /**
  * This exception is thrown when parse errors are encountered.
  * You can explicitly create objects of this exception type by

